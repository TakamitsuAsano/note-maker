import streamlit as st

# --- ページ設定 ---
st.set_page_config(
    page_title="菊池優太のSpace Note Maker (Story Edition)",
    page_icon="🚀",
    layout="wide"
)

# --- データの定義（リーダーシップ理論とカテゴリ） ---
# 理論の定義は前回と同じですが、プロンプトでの扱い方が変わります
leadership_theories = {
    "1. イノベーション・変革・起業": {
        "イノベーターのDNA": "破壊的イノベーターに共通する5つのスキル（関連づける、質問する、観察する、ネットワーク、実験する）。",
        "シリアル・イノベーター": "組織内の政治的な壁を乗り越え、何度もイノベーションを成功させる技術力と政治力を持つ人材。",
        "両利きのリーダーシップ": "既存事業の深掘り（知の深化）と、新規事業の探索（知の探索）を同時にマネジメントする。",
        "エフェクチュエーション": "目的から逆算せず、手持ちの手段（鳥）から何ができるかを考え、不確実性をコントロールする。",
        "イントラプレナーシップ": "社内起業家精神。組織に属しながらリスクを取り、自律的に新規事業を推進する。",
        "変革型リーダーシップ": "ビジョンを掲げ、メンバーの意識や価値観を根本から変革し、期待以上の成果を引き出す。",
        "アダプティブ・リーダーシップ": "適応を要する課題に対し、組織の痛みを伴う変化（学習や価値観の転換）を促す。",
        "ブルー・オーシャン・リーダーシップ": "管理職の「やめるべき業務」を捨て、「付加価値の高い業務」へ時間をシフトさせる。"
    },
    "2. 組織・チーム・人間関係重視": {
        "サーバント・リーダーシップ": "リーダーはまず奉仕者であれ。メンバーの強みを活かし、目標達成を支援する。",
        "オーセンティック・リーダーシップ": "自分らしさ（真正性）を重視。倫理観や価値観に正直であり、信頼を得る。",
        "レベル5・リーダーシップ": "「個人的な謙虚さ」と「職業人としての不屈の意志」を兼ね備える。",
        "EQリーダーシップ": "EQ（心の知能指数）を重視し、自分と他者の感情を理解・管理してチームを動かす。",
        "インクルーシブ・リーダーシップ": "多様性を尊重し、すべてのメンバーが受け入れられていると感じさせる。",
        "シェアード・リーダーシップ": "特定の1人ではなく、全員が状況に応じてリーダーシップを分担・発揮する。"
    },
    "3. 古典的・学術的": {
        "PM理論": "目標達成機能（P）と集団維持機能（M）の2軸で捉える。",
        "状況対応理論 (SL理論)": "部下の成熟度に合わせて、指示・説得・参加・委任とスタイルを変える。",
        "条件適合理論": "リーダーの資質と状況の相性で成果が決まるとする。",
        "マネジリアル・グリッド": "業績への関心と人間への関心の2軸で分類。",
        "特性理論": "リーダーシップは生まれ持った才能であるとする古典的考え。"
    },
    "4. 新しい組織形態": {
        "アジャイル・リーダーシップ": "権限委譲を進め、自律的なチームが迅速に動ける環境を整備する庭師のような役割。",
        "ティール組織のリーダーシップ": "ヒエラルキーを手放し、組織を生命体と捉え、自主経営を見守る。",
        "ホラクラシー": "役職ではなく役割（ロール）に基づいて組織を運営する権限分散型。"
    }
}

recommendations = {
    "0→1の新規事業フェーズ": ["エフェクチュエーション", "イノベーターのDNA", "イントラプレナーシップ"],
    "組織の拡大期・混乱期": ["サーバント・リーダーシップ", "心理的安全性(インクルーシブ)", "アダプティブ・リーダーシップ"],
    "既存事業と新規事業の対立": ["両利きのリーダーシップ", "シリアル・イノベーター", "変革型リーダーシップ"],
    "成熟した組織の変革": ["ブルー・オーシャン・リーダーシップ", "ティール組織のリーダーシップ"]
}

# --- UI構築 ---

st.title("🚀 Space Note Maker (Storytelling Ver.)")
st.markdown("""
菊池優太のNote記事作成支援アプリ（楠木建スタイル版）。  
入力された情報を、「論理」と「ユーモア」を交えた**読み物としてのストーリー**に変換するプロンプトを生成します。
""")

st.divider()

col1, col2 = st.columns([1, 1])

with col1:
    st.subheader("1. ネタの入力")
    st.info("今週、心が動いた情報やエピソードを入力してください。具体的であればあるほど、「ストーリー」として面白くなります。")
    narrative_input = st.text_area("インプット情報（Source Material）", height=300, placeholder="例：ある町工場のオヤジさんと話したんですが、彼が言った一言が強烈で...")

with col2:
    st.subheader("2. 視点の選択")
    filter_option = st.selectbox("今の状況・フェーズは？（おすすめを表示）", ["指定なし"] + list(recommendations.keys()))
    
    recommended_theories = []
    if filter_option != "指定なし":
        recommended_theories = recommendations[filter_option]
        st.success(f"おすすめ: {', '.join(recommended_theories)}")

    category = st.selectbox("リーダーシップのカテゴリ", list(leadership_theories.keys()))
    theory_name = st.selectbox("適用する理論のレンズ", list(leadership_theories[category].keys()))
    theory_desc = leadership_theories[category][theory_name]
    st.caption(f"**{theory_name}**: {theory_desc}")

st.divider()

# --- プロンプト生成ロジック（ここを楠木建スタイルへ変更） ---

if st.button("Generate Prompt (プロンプト生成)"):
    if not narrative_input:
        st.error("インプット情報を入力してください。")
    else:
        # 楠木建スタイルを適用したプロンプトテンプレート
        prompt_text = f"""
あなたは宇宙ビジネスの現場を走り回る「菊池優太」として、Note記事を執筆してください。
ただし、文章の構成と語り口については、経営学者・楠木建氏のエッセイ（『ストーリーとしての競争戦略』や『好きなようにしてください』等）のスタイルを憑依させてください。

# 1. 文章のスタイル（楠木建メソッド）
* **語り口:** * 「～なんですね」「～だと思うのです」「～なわけです」といった、読者に隣で語りかけるような、少しくだけた丁寧語（デス・マス調）。
    * 堅苦しい論文調ではなく、ユーモアと知性が同居するエッセイ調。
* **思考の型:**
    * 「良し悪し」よりも「好き嫌い」や「向き不向き」を大切にする。
    * 表面的な事象の裏にある「文脈（ストーリー）」を面白がる。
    * 論理（ロジック）は通すが、理屈っぽくならないように「人間の性（さが）」や「商売のリアル」を混ぜ込む。
* **禁止事項（重要）:**
    * **「〇〇氏によると」「楠木建氏も言っているように」といった第三者の引用は絶対に禁止。** 全て菊池優太自身の思考、気づきとして語ること。
    * 難解な専門用語やカタカナ語（「パラダイムシフト」「アウフヘーベン」等）を多用しない。中学生でもわかる言葉で本質を突くこと。
    * 菊池自身が経験していないことを「私の経験では」と嘘をつかないこと。

# 2. 記事の構成要素
* **インプット情報（今週のネタ）:**
{narrative_input}

* **思考のレンズ（今回のテーマ）:**
    * **概念:** {theory_name}
    * **定義:** {theory_desc}
    * **適用方法:** この理論の名称をそのまま解説するのではなく、この理論が持つ「本質的な意味」を、インプット情報の解釈に使ってください。

# 3. 執筆のフロー
1.  **導入 (Hook): 具体的なエピソードから入る**
    * 「先日、こんな面白いことがあったんです」というトーンでインプット情報を紹介する。
    * 「一見、宇宙とは関係なさそうに見えますが、ここには商売（ビジネス）の本質が詰まっていると思うのです」と繋げる。
2.  **展開 (Story): 論理をストーリーにする**
    * ここで「{theory_name}」の考え方を、専門用語を使わずに展開する。
    * 「要するに、こういうことなんですね」と噛み砕く。
    * 「多くの企業はここを勘違いしている」という逆説や、「人間だもの、そうなるよね」という共感を挟む。
3.  **結論 (Message): 燻っている人へのエール**
    * ターゲット読者（古い組織で燻っている承認欲求強めの人材）に対し、「あなたが感じている違和感は、実は正しい」と肯定する。
    * 「宇宙ビジネスという新しいフィールドなら、その『こだわり』や『偏愛』が最強の武器になる」と、背中を押す（ただし、熱血すぎず、飄々と諭すように）。

# 4. 出力形式
* タイトル案（「〇〇はなぜ面白いのか」「〇〇という『センス』について」など、楠木建風のひねりのあるタイトル）
* 記事本文（そのままNoteに投稿できる完成稿）
"""
        
        st.subheader("生成されたプロンプト")
        st.write("以下のテキストをコピーして、Gemini等のAIに貼り付けてください。")
        st.code(prompt_text, language="text")
        st.success("プロンプトを作成しました！楠木建テイストの文章が生成されます。")

st.markdown("---")
st.caption("Powered by Streamlit | Style: Ken Kusunoki Hybrid")
